doctype html
html
    head
        meta(charset='utf-8')
        meta(name='viewport', content='width=device-width, initial-scale=1.0')
        title
    body(style="padding:0px; margin:0px; background-color:#fff;font-family:'Open Sans',sans-serif,arial,helvetica,verdana")
        // #region Jssor Slider Begin
        // Generator: Jssor Slider Maker
        // Source: https://www.jssor.com
        script(src='../javascripts/image_slider.js', type='text/javascript')
        script(src='../javascripts/CartoonModel.js', type='text/javascript')
        script(src='../javascripts/TreeModel.js', type='text/javascript')
        link(rel='stylesheet', type='text/css', href='../stylesheets/image_slider.css')
        link(rel='stylesheet', type='text/css', href='../stylesheets/floating_button.css')
        script(type='text/javascript').
        button#load-btn
            sapn.menu-icon
        button#sub-scrn-btn.floating-btn.is--off
            span.menu-icon
        script(type='text/javascript').
            sliderOpt = {
                imageWidth: 500,
                imageHeigth: 350,
                gravity:"center"
            };
            story = [];
            slider = [];
            sliderData = [];
            var test;
            var i;

            test = new Cartoon("testComic", 1, "../images/001.jpg");
            test.root.addChild(2, "../images/a.png");
            test.root.addChild(3, "../images/b.png");
            test.root.addChild(10, "../images/c.png");
            test.root.child[0].addChild(4, "../images/aa.png");
            test.root.child[0].addChild(5, "../images/ab.png");
            test.root.child[0].addChild(6, "../images/ac.png");
            test.root.child[0].addChild(7, "../images/ac.png");
            test.root.child[1].addChild(11, "../images/ba.png");
            test.root.child[1].addChild(12, "../images/bb.png");
            test.root.child[1].addChild(13, "../images/bc.png");
            test.root.child[1].addChild(14, "../images/bd.png");
            test.root.child[0].child[0].addChild(8, "../images/aaa.png");
            test.root.child[0].child[0].addChild(9, "../images/aab.png");
            test.root.child[0].child[0].addChild(15, "../images/aac.png");
            test.root.child[1].child[0].addChild(16, "../images/bab.png");
            test.root.child[1].child[0].addChild(17, "../images/bac.png");
            test.root.child[1].child[0].addChild(18, "../images/bac.png");
            test.root.child[1].child[1].addChild(19, "../images/bba.png");
            test.root.child[1].child[1].addChild(20, "../images/bbb.png");
            test.root.child[1].child[1].addChild(21, "../images/bbc.png");
            test.root.child[0].child[0].child[0].addChild(22, "../images/aaaa.png");
            test.root.child[0].child[0].child[0].addChild(23, "../images/aaab.png");
            test.root.child[0].child[0].child[0].addChild(24, "../images/aaac.png");
            test.root.child[1].child[0].child[0].addChild(25, "../images/baaa.png");
            test.root.child[1].child[0].child[0].addChild(26, "../images/baab.png");
            test.root.child[1].child[0].child[0].addChild(27, "../images/baac.png");

            var temp = test.root;
            for (var i = 0; temp.child.length > 0; temp = temp.child[0], i++) {
                story.push(temp.child);
                sliderData[i] = new ImageSlider(i, sliderOpt);
                slider[i] = sliderData[i].create(temp.child);
                document.body.appendChild(slider[i]);
                sliderData[i].prev.addEventListener("click", function (event) {
                    storyChange(event)
                }, false);
                sliderData[i].next.addEventListener("click", function (event) {
                    storyChange(event)
                }, false);
            }

            index = 0;
            pre=1;
            window.onscroll = function (ev) {
                var top  = window.pageYOffset || document.documentElement.scrollTop;
                var imageHeight = 350;
                cur = (parseInt((top+window.innerHeight/2)/imageHeight)).toString()
                if(pre!=cur){
                    slider[pre].style.border="none";
                    slider[cur].style.border = "3px solid green"
                    pre = cur;
                }
                if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
                    console.log("scroll end");
                    //create_slider(testCuts, index++);
                }
            };
            (function (){
                "use strict";
                var floatingBtn = document.getElementById("sub-scrn-btn");
                floatingBtn.addEventListener("click", function (e) {
                    var btn = e.currentTarget;
                    btn.classList.toggle("is--off");
                });
            })();
            window.onload = function () {
            }
            window.onresize = function () {
                slider.forEach(function (v, i) {
                    v.changeWindowSize();
                });
            }
            function storyChange(e) {
                var info = e.target.id.split("_");
                var eventType = info[0];
                var sliderNum = parseInt(info[1]);
                var eventSlider = sliderData[sliderNum];
                while (sliderNum + 1 < slider.length) {
                    sliderData.pop();
                    story.pop();
                    slider.pop().remove();
                };
                var temp
                if(eventType=="prev"){
                    if(sliderData[sliderNum].currentImage==0)
                        temp = story[sliderNum][eventSlider.li_items.length-1];
                    else
                        temp = story[sliderNum][eventSlider.currentImage - 1];
                } else if(eventType=="next"){
                    if (sliderData[sliderNum].currentImage == eventSlider.li_items.length-1)
                        temp = story[sliderNum][0];
                    else
                        temp = story[sliderNum][eventSlider.currentImage + 1];
                }
                for(var i=sliderNum+1 ; temp.child.length>0 ; temp = temp.child[0], i++)
                {
                    story.push(temp.child);
                    sliderData[i] = new ImageSlider(i, sliderOpt);
                    slider[i] = sliderData[i].create(temp.child);
                    document.body.appendChild(slider[i]);
                    sliderData[i].prev.addEventListener("click", function (event) {
                        storyChange(event)
                    }, false);
                    sliderData[i].next.addEventListener("click", function (event) {
                        storyChange(event)
                    }, false);
                }
                console.log(story);
            }

// #endregion Jssor Slider End
